# 2PC 和 3PC

**作为单个逻辑工作单元执行的一系列操作，要么全部执行，要么全部不执行。** 

- 2pc（两段式提交）
- 3pc（三段式提交）
- TCC（Try、Confirm、Cancel）
- 半消息/最终一致性（RocketMQ）


## 2PC

说到 2PC 就不得不聊数据库分布式事务中的 XA Transactions。


在 XA 协议中分为两阶段：

1. 事务管理器要求每个涉及到事务的数据库预提交(precommit)此操作，并反映是否可以提交。
1. 事务协调器要求每个数据库提交数据，或者回滚数据。

优点：

- XA 协议比较简单，成本较低，在各大主流数据库都有自己实现
- 尽量保证了数据的强一致，对于 MySQL 是从 5.5 开始支持。

缺点：

**1. 单点问题**

事务管理器在整个流程中扮演的角色很关键，如果其宕机，比如在***阶段已经完成，在第二阶段正准备提交的时候事务管理器宕机，资源管理器就会一直阻塞，导致数据库无法使用。

**2. 同步阻塞**

在准备就绪之后，资源管理器中的资源一直处于阻塞，直到提交完成，释放资源。

**3. 数据不一致**

两阶段提交协议虽然为分布式数据强一致性所设计，但仍然存在数据不一致性的可能。比如在第二阶段中，假设协调者发出了事务 Commit 的通知，但是因为网络问题该通知仅被一部分参与者所收到并执行了 Commit 操作，其余的参与者则因为没有收到通知一直处于阻塞状态，这时候就产生了数据的不一致性。


https://www.jianshu.com/p/dd6a340e50b2